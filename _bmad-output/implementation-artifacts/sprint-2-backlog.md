# Sprint 2 Backlog - Epic 3: Badge Template Management

**Sprintå‘¨æœŸï¼š** 2026-01-27 è‡³ 2026-02-07ï¼ˆ10ä¸ªå·¥ä½œæ—¥ï¼‰  
**Sprintç›®æ ‡ï¼š** å»ºç«‹å®Œæ•´çš„æ•°å­—å¾½ç« æ¨¡æ¿ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒçµæ´»çš„æŠ€èƒ½åˆ†ç±»ä½“ç³»å’ŒAzure Blobå›¾ç‰‡å­˜å‚¨  
**æ€»å·¥ä½œé‡ï¼š** 32-33å°æ—¶  
**çŠ¶æ€ï¼š** ğŸ”„ In Progress (3.5/6 stories complete, ~58%)

**å¼€å§‹æ—¶é—´ï¼š** 2026-01-26  
**å®é™…è¿›åº¦ï¼š** 4 storieså®Œæˆï¼Œç”¨æ—¶çº¦3å°æ—¶ï¼ˆvs ä¼°ç®—21-22hï¼Œæ•ˆç‡æå‡7-8å€ï¼‰

---

## Sprint 2 Progress Tracker

### å·²å®Œæˆ Stories âœ…
- âœ… **Story 3.1** - å¾½ç« æ¨¡æ¿ä¸æŠ€èƒ½åˆ†ç±»æ•°æ®æ¨¡å‹ï¼ˆå®é™…ï¼š30min / ä¼°ç®—ï¼š5-6hï¼‰
  - Commit: 1dbe124
  - å®Œæˆæ—¶é—´ï¼š2026-01-26
- âœ… **Story 3.6** - è‡ªå®šä¹‰æŠ€èƒ½åˆ†ç±»ç®¡ç†ï¼ˆå®é™…ï¼š40min / ä¼°ç®—ï¼š4-5hï¼‰
  - Commit: 01fc160
  - å®Œæˆæ—¶é—´ï¼š2026-01-26
- âœ… **Story 3.2** - åˆ›å»ºå¾½ç« æ¨¡æ¿API + Azure Blobé›†æˆï¼ˆå®é™…ï¼š50min / ä¼°ç®—ï¼š6-7hï¼‰
  - Commit: dbad53e
  - å®Œæˆæ—¶é—´ï¼š2026-01-26
- âœ… **Story 3.3** - æŸ¥è¯¢å¾½ç« æ¨¡æ¿APIï¼ˆå®é™…ï¼š30min / ä¼°ç®—ï¼š3-4hï¼‰
  - Commit: a64f932
  - å®Œæˆæ—¶é—´ï¼š2026-01-26
  - åŒ…æ‹¬ï¼šå®‰å…¨æ–‡æ¡£ï¼ˆdocs/security-notes.mdï¼‰

### è¿›è¡Œä¸­ Stories ğŸ”„
- â¸ï¸ æ— 

### å¾…å¼€å§‹ Stories â¸ï¸
- â¸ï¸ **Story 3.4** - å¾½ç« ç›®å½•ä¸æœç´¢ä¼˜åŒ–ï¼ˆä¼°ç®—ï¼š4-5hï¼‰
- â¸ï¸ **Story 3.5** - é¢å‘æ ‡å‡†å®šä¹‰ï¼ˆä¼°ç®—ï¼š3-4hï¼‰

### æ•ˆç‡åˆ†æ ğŸ“Š
- **å®Œæˆç‡ï¼š** 67% (4/6 stories)
- **æ—¶é—´ä½¿ç”¨ï¼š** ~3h / ä¼°ç®— 21-22h (14% æ—¶é—´ä½¿ç”¨ç‡)
- **æ•ˆç‡æå‡ï¼š** ~7-8å€
- **å‰©ä½™å·¥ä½œé‡ï¼š** 7-9h ä¼°ç®— â†’ é¢„è®¡å®é™… 1-1.5h

---

## Sprint 2 Scope Summary

### æ ¸å¿ƒStoriesï¼ˆEpic 3ï¼‰
- **Story 3.1** - å¾½ç« æ¨¡æ¿ä¸æŠ€èƒ½åˆ†ç±»æ•°æ®æ¨¡å‹ï¼ˆ5-6hï¼‰âœ…
- **Story 3.2** - åˆ›å»ºå¾½ç« æ¨¡æ¿API + Azure Blobé›†æˆï¼ˆ6-7hï¼‰âœ…
- **Story 3.3** - æŸ¥è¯¢å¾½ç« æ¨¡æ¿APIï¼ˆ3-4hï¼‰âœ…
- **Story 3.4** - å¾½ç« ç›®å½•ä¸æœç´¢ä¼˜åŒ–ï¼ˆ4-5hï¼‰â¸ï¸
- **Story 3.5** - é¢å‘æ ‡å‡†å®šä¹‰ï¼ˆ3-4hï¼‰â¸ï¸
- **Story 3.6** - è‡ªå®šä¹‰æŠ€èƒ½åˆ†ç±»ç®¡ç†ï¼ˆ4-5hï¼‰âœ…

### Enhancements
- **Enhancement 1** - Azure Blobå›¾ç‰‡å®Œæ•´ç®¡ç†ï¼ˆ2-3hï¼‰

### æ’é™¤é¡¹ï¼ˆå»¶æœŸåˆ°Sprint 3+ï¼‰
- âŒ å¾½ç« å®¡æ‰¹å·¥ä½œæµ
- âŒ å®Œæ•´çš„åˆ†ç±»ç®¡ç†UI
- âŒ åˆ†ç±»æ¨¡æ¿å¸‚åœº/å¯¼å…¥å¯¼å‡º

---

## æŠ€èƒ½åˆ†ç±»æ¨¡æ¿ï¼ˆ5ä¸ªï¼‰

| # | åˆ†ç±»åç§° | è‹±æ–‡åç§° | å…¸å‹å­åˆ†ç±» |
|---|---------|---------|-----------|
| 1 | æŠ€æœ¯æŠ€èƒ½ | Technical Skills | ç¼–ç¨‹è¯­è¨€ã€å¼€å‘å·¥å…·ã€äº‘å¹³å°ã€æ•°æ®åº“ |
| 2 | è½¯æŠ€èƒ½ | Soft Skills | æ²Ÿé€šèƒ½åŠ›ã€é¢†å¯¼åŠ›ã€å›¢é˜Ÿåä½œã€é—®é¢˜è§£å†³ |
| 3 | è¡Œä¸šçŸ¥è¯† | Domain Knowledge | é‡‘èã€åŒ»ç–—ã€æ•™è‚²ã€åˆ¶é€  |
| 4 | **å…¬å¸ç‰¹å®šèƒ½åŠ›** | Company-Specific Competencies | ä¼ä¸šæ–‡åŒ–ã€å†…éƒ¨æµç¨‹ã€ä¸“æœ‰å·¥å…·ã€åˆè§„è¦æ±‚ |
| 5 | é€šç”¨èŒä¸šæŠ€èƒ½ | Professional Skills | é¡¹ç›®ç®¡ç†ã€æ•°æ®åˆ†æã€å•†åŠ¡æ¼”è®²ã€æ—¶é—´ç®¡ç† |

---

## Story 3.1: å¾½ç« æ¨¡æ¿ä¸æŠ€èƒ½åˆ†ç±»æ•°æ®æ¨¡å‹

**ä¼˜å…ˆçº§ï¼š** P0 (æœ€é«˜)  
**ä¼°ç®—æ—¶é—´ï¼š** 5-6å°æ—¶  
**ä¾èµ–ï¼š** Sprint 1å®Œæˆ  
**é£é™©ç­‰çº§ï¼š** Mediumï¼ˆæŠ€èƒ½åˆ†ç±»è®¾è®¡å¤æ‚ï¼‰

### ç”¨æˆ·æ•…äº‹
> ä½œä¸º**ç³»ç»Ÿæ¶æ„å¸ˆ**ï¼Œæˆ‘éœ€è¦**è®¾è®¡å¾½ç« æ¨¡æ¿å’ŒæŠ€èƒ½åˆ†ç±»çš„æ•°æ®æ¨¡å‹**ï¼Œä»¥ä¾¿**æ”¯æŒçµæ´»çš„å¾½ç« ç®¡ç†å’Œè‡ªå®šä¹‰åˆ†ç±»èƒ½åŠ›**ã€‚

### éªŒæ”¶æ ‡å‡†
- [ ] Prisma schemaå®šä¹‰å®Œæ•´ï¼ˆBadgeTemplate, Skill, SkillCategoryï¼‰
- [ ] æ”¯æŒ5ä¸ªé¢„è®¾åˆ†ç±»æ¨¡æ¿ + è‡ªå®šä¹‰èƒ½åŠ›
- [ ] æŠ€èƒ½åˆ†ç±»æ”¯æŒå¤šå±‚åµŒå¥—ï¼ˆè‡³å°‘3å±‚ï¼‰
- [ ] æ•°æ®åº“è¿ç§»æˆåŠŸæ‰§è¡Œ
- [ ] åˆ›å»ºåˆå§‹ç§å­æ•°æ®ï¼ˆ5ä¸ªåˆ†ç±»æ¨¡æ¿ï¼‰

### æŠ€æœ¯ä»»åŠ¡

**Task 3.1.1: è®¾è®¡BadgeTemplateæ¨¡å‹**ï¼ˆ1.5å°æ—¶ï¼‰
```prisma
model BadgeTemplate {
  id              String   @id @default(uuid())
  name            String   @db.VarChar(100)
  description     String?  @db.Text
  imageUrl        String?  // Azure Blob URL
  category        String   @db.VarChar(50)
  skillIds        String[] // å…³è”çš„æŠ€èƒ½IDæ•°ç»„
  issuanceCriteria Json    // é¢å‘æ ‡å‡†ï¼ˆçµæ´»çš„JSONç»“æ„ï¼‰
  validityPeriod  Int?     // æœ‰æ•ˆæœŸï¼ˆå¤©æ•°ï¼Œnullè¡¨ç¤ºæ°¸ä¹…ï¼‰
  status          BadgeStatus @default(DRAFT)
  createdBy       String
  creator         User     @relation(fields: [createdBy], references: [id])
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([category])
  @@index([status])
  @@index([createdAt])
}

enum BadgeStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}
```

**Task 3.1.2: è®¾è®¡SkillCategoryæ¨¡å‹**ï¼ˆ2å°æ—¶ï¼‰
```prisma
model SkillCategory {
  id              String   @id @default(uuid())
  name            String   @db.VarChar(100)
  nameEn          String?  @db.VarChar(100) // è‹±æ–‡åç§°
  description     String?  @db.Text
  parentId        String?
  parent          SkillCategory? @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children        SkillCategory[] @relation("CategoryHierarchy")
  level           Int      @default(1) // 1=é¡¶å±‚, 2=äºŒçº§, 3=ä¸‰çº§
  isSystemDefined Boolean  @default(false) // true=é¢„è®¾, false=è‡ªå®šä¹‰
  isEditable      Boolean  @default(true)
  displayOrder    Int      @default(0)
  skills          Skill[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([parentId])
  @@index([isSystemDefined])
  @@index([level])
}
```

**Task 3.1.3: è®¾è®¡Skillæ¨¡å‹**ï¼ˆ1å°æ—¶ï¼‰
```prisma
model Skill {
  id          String        @id @default(uuid())
  name        String        @db.VarChar(100)
  description String?       @db.Text
  categoryId  String
  category    SkillCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  level       SkillLevel?   // æŠ€èƒ½ç­‰çº§ï¼ˆå¯é€‰ï¼‰
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  
  @@index([categoryId])
  @@unique([name, categoryId]) // åŒä¸€åˆ†ç±»ä¸‹æŠ€èƒ½åç§°å”¯ä¸€
}

enum SkillLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}
```

**Task 3.1.4: åˆ›å»ºæ•°æ®åº“è¿ç§»**ï¼ˆ0.5å°æ—¶ï¼‰
```bash
npx prisma migrate dev --name add_badge_and_skill_models
```

**Task 3.1.5: åˆ›å»ºç§å­æ•°æ®**ï¼ˆ1å°æ—¶ï¼‰
```typescript
// prisma/seed-skills.ts
const skillCategories = [
  {
    name: 'æŠ€æœ¯æŠ€èƒ½',
    nameEn: 'Technical Skills',
    level: 1,
    isSystemDefined: true,
    children: [
      { name: 'ç¼–ç¨‹è¯­è¨€', level: 2 },
      { name: 'å¼€å‘å·¥å…·', level: 2 },
      { name: 'äº‘å¹³å°', level: 2 },
      { name: 'æ•°æ®åº“', level: 2 }
    ]
  },
  {
    name: 'è½¯æŠ€èƒ½',
    nameEn: 'Soft Skills',
    level: 1,
    isSystemDefined: true,
    children: [
      { name: 'æ²Ÿé€šèƒ½åŠ›', level: 2 },
      { name: 'é¢†å¯¼åŠ›', level: 2 },
      { name: 'å›¢é˜Ÿåä½œ', level: 2 },
      { name: 'é—®é¢˜è§£å†³', level: 2 }
    ]
  },
  {
    name: 'è¡Œä¸šçŸ¥è¯†',
    nameEn: 'Domain Knowledge',
    level: 1,
    isSystemDefined: true,
    children: [
      { name: 'é‡‘è', level: 2 },
      { name: 'åŒ»ç–—', level: 2 },
      { name: 'æ•™è‚²', level: 2 },
      { name: 'åˆ¶é€ ', level: 2 }
    ]
  },
  {
    name: 'å…¬å¸ç‰¹å®šèƒ½åŠ›',
    nameEn: 'Company-Specific Competencies',
    level: 1,
    isSystemDefined: true,
    children: [
      { name: 'ä¼ä¸šæ–‡åŒ–', level: 2 },
      { name: 'å†…éƒ¨æµç¨‹', level: 2 },
      { name: 'ä¸“æœ‰å·¥å…·', level: 2 },
      { name: 'åˆè§„è¦æ±‚', level: 2 }
    ]
  },
  {
    name: 'é€šç”¨èŒä¸šæŠ€èƒ½',
    nameEn: 'Professional Skills',
    level: 1,
    isSystemDefined: true,
    children: [
      { name: 'é¡¹ç›®ç®¡ç†', level: 2 },
      { name: 'æ•°æ®åˆ†æ', level: 2 },
      { name: 'å•†åŠ¡æ¼”è®²', level: 2 },
      { name: 'æ—¶é—´ç®¡ç†', level: 2 }
    ]
  }
];
```

**æµ‹è¯•è¦æ±‚ï¼š**
- [ ] æ•°æ®æ¨¡å‹å…³ç³»å®Œæ•´æ€§æµ‹è¯•
- [ ] ç§å­æ•°æ®æˆåŠŸåŠ è½½
- [ ] çº§è”åˆ é™¤æµ‹è¯•ï¼ˆåˆ é™¤åˆ†ç±»æ—¶å­åˆ†ç±»å’ŒæŠ€èƒ½çš„å¤„ç†ï¼‰

---

## Story 3.2: åˆ›å»ºå¾½ç« æ¨¡æ¿API + Azure Blobé›†æˆ

**ä¼˜å…ˆçº§ï¼š** P0  
**ä¼°ç®—æ—¶é—´ï¼š** 6-7å°æ—¶  
**ä¾èµ–ï¼š** Story 3.1  
**é£é™©ç­‰çº§ï¼š** Mediumï¼ˆAzureé›†æˆéœ€æµ‹è¯•ï¼‰

### ç”¨æˆ·æ•…äº‹
> ä½œä¸º**ç®¡ç†å‘˜**ï¼Œæˆ‘éœ€è¦**åˆ›å»ºå¾½ç« æ¨¡æ¿å¹¶ä¸Šä¼ å›¾ç‰‡**ï¼Œä»¥ä¾¿**å®šä¹‰å¯é¢å‘çš„æ•°å­—å¾½ç« ç±»å‹**ã€‚

### éªŒæ”¶æ ‡å‡†
- [ ] POST /api/admin/badge-templates æ¥å£å®Œæˆ
- [ ] æ”¯æŒä¸Šä¼ å›¾ç‰‡åˆ°Azure Blob Storage
- [ ] å›¾ç‰‡éªŒè¯ï¼ˆæ ¼å¼: PNG/JPG, å¤§å°: â‰¤2MB, å°ºå¯¸: å»ºè®®512x512ï¼‰
- [ ] å­—æ®µéªŒè¯å®Œæ•´ï¼ˆDTO + Validation Pipeï¼‰
- [ ] è¿”å›å®Œæ•´çš„å¾½ç« æ¨¡æ¿ä¿¡æ¯ï¼ˆå«å›¾ç‰‡URLï¼‰

### æŠ€æœ¯ä»»åŠ¡

**Task 3.2.1: éªŒè¯Azure Blobé…ç½®**ï¼ˆ0.5å°æ—¶ï¼‰

> âš ï¸ **æ³¨æ„ï¼šSprint 0å·²åˆ›å»ºAzureèµ„æºï¼Œæ— éœ€é‡å¤åˆ›å»ºï¼**  
> è¯¦è§ [`docs/infrastructure-inventory.md`](../../docs/infrastructure-inventory.md)

```typescript
// gcredit-project/backend/src/config/azure-blob.config.ts
import { BlobServiceClient } from '@azure/storage-blob';

export const azureBlobConfig = {
  connectionString: process.env.AZURE_STORAGE_CONNECTION_STRING,
  containerName: process.env.AZURE_STORAGE_CONTAINER_BADGES, // 'badges'
};

export const getBlobServiceClient = () => {
  return BlobServiceClient.fromConnectionString(
    azureBlobConfig.connectionString
  );
};
```

**ç¯å¢ƒå˜é‡ï¼ˆSprint 0å·²é…ç½®ï¼‰ï¼š**
```env
# Sprint 0å·²åˆ›å»º - ä½äº gcredit-project/backend/.env
AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=gcreditdevstoragelz;...
AZURE_STORAGE_ACCOUNT_NAME=gcreditdevstoragelz
AZURE_STORAGE_CONTAINER_BADGES=badges
AZURE_STORAGE_CONTAINER_EVIDENCE=evidence
```

**éªŒè¯æ­¥éª¤ï¼š**
1. ç¡®è®¤`.env`æ–‡ä»¶åŒ…å«ä¸Šè¿°é…ç½®
2. è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š`npx ts-node scripts/test-azure-blob.ts`
3. éªŒè¯æˆåŠŸåç»§ç»­Task 3.2.2

**å‚è€ƒæ–‡æ¡£ï¼š**
- AzureéªŒè¯æŒ‡å—ï¼š[`sprint-2-azure-setup-guide.md`](./sprint-2-azure-setup-guide.md)
- Sprint 0èµ„æºæ¸…å•ï¼š[`infrastructure-inventory.md`](../../docs/infrastructure-inventory.md)

**Task 3.2.2: åˆ›å»ºå›¾ç‰‡ä¸Šä¼ Service**ï¼ˆ2å°æ—¶ï¼‰

âš ï¸ **è·¯å¾„è¯´æ˜ï¼š** Serviceæ”¾åœ¨ `src/common/services/` å› ä¸ºå®ƒæ˜¯è·¨æ¨¡å—å…±äº«çš„åŸºç¡€è®¾æ–½

```typescript
// gcredit-project/backend/src/common/services/blob-storage.service.ts
@Injectable()
export class BlobStorageService {
  private containerClient: ContainerClient;

  async uploadImage(
    file: Express.Multer.File,
    folder: string
  ): Promise<string> {
    // éªŒè¯å›¾ç‰‡
    this.validateImage(file);
    
    // ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
    const fileName = `${folder}/${uuidv4()}-${file.originalname}`;
    
    // ä¸Šä¼ åˆ°Azure Blob
    const blockBlobClient = this.containerClient.getBlockBlobClient(fileName);
    await blockBlobClient.upload(file.buffer, file.size, {
      blobHTTPHeaders: { blobContentType: file.mimetype }
    });
    
    return blockBlobClient.url;
  }

  async deleteImage(url: string): Promise<void> {
    const blobName = this.extractBlobName(url);
    const blockBlobClient = this.containerClient.getBlockBlobClient(blobName);
    await blockBlobClient.delete();
  }

  private validateImage(file: Express.Multer.File): void {
    const allowedTypes = ['image/png', 'image/jpeg'];
    const maxSize = 2 * 1024 * 1024; // 2MB

    if (!allowedTypes.includes(file.mimetype)) {
      throw new BadRequestException('Only PNG and JPG images are allowed');
    }

    if (file.size > maxSize) {
      throw new BadRequestException('Image size must not exceed 2MB');
    }
  }
}
```

**Task 3.2.3: åˆ›å»ºDTOå’ŒéªŒè¯**ï¼ˆ1å°æ—¶ï¼‰

âš ï¸ **è·¯å¾„è¯´æ˜ï¼š** `badge-templates/` æ˜¯å¹³çº§åŠŸèƒ½æ¨¡å—ï¼ˆSprint 2æ–°æ¨¡å¼ï¼‰ï¼Œä¸åœ¨ `modules/` ä¸‹

```typescript
// gcredit-project/backend/src/badge-templates/dto/create-badge-template.dto.ts
export class CreateBadgeTemplateDto {
  @IsString()
  @Length(3, 100)
  name: string;

  @IsString()
  @IsOptional()
  @MaxLength(1000)
  description?: string;

  @IsString()
  @IsIn(['achievement', 'skill', 'certification', 'participation'])
  category: string;

  @IsArray()
  @IsUUID('4', { each: true })
  skillIds: string[];

  @IsObject()
  issuanceCriteria: Record<string, any>;

  @IsInt()
  @Min(1)
  @IsOptional()
  validityPeriod?: number;
}
```

**Task 3.2.4: å®ç°Controllerå’ŒService**ï¼ˆ1.5å°æ—¶ï¼‰

âš ï¸ **Importè·¯å¾„è§„èŒƒï¼š**
```typescript
// Guardså’ŒDecoratorsä» '../common/' å¯¼å…¥
import { JwtAuthGuard } from '../common/guards/jwt-auth.guard';
import { RolesGuard } from '../common/guards/roles.guard';
import { Roles } from '../common/decorators/roles.decorator';
```

```typescript
// gcredit-project/backend/src/badge-templates/badge-templates.controller.ts
@Controller('admin/badge-templates')
@UseGuards(JwtAuthGuard, RolesGuard)
@Roles(UserRole.ADMIN)
export class BadgeTemplatesController {
  @Post()
  @UseInterceptors(FileInterceptor('image'))
  async create(
    @Body() dto: CreateBadgeTemplateDto,
    @UploadedFile() image: Express.Multer.File,
    @CurrentUser() user: User
  ) {
    return this.badgeTemplatesService.create(dto, image, user.id);
  }
}

// gcredit-project/backend/src/badge-templates/badge-templates.service.ts
// âš ï¸ PrismaServiceä» '../common/' å¯¼å…¥:
// import { PrismaService } from '../common/prisma.service';
// import { BlobStorageService } from '../common/services/blob-storage.service';

@Injectable()
export class BadgeTemplatesService {
  async create(
    dto: CreateBadgeTemplateDto,
    image: Express.Multer.File,
    userId: string
  ): Promise<BadgeTemplate> {
    // ä¸Šä¼ å›¾ç‰‡
    let imageUrl: string | null = null;
    if (image) {
      imageUrl = await this.blobStorageService.uploadImage(image, 'badges');
    }

    // éªŒè¯æŠ€èƒ½IDå­˜åœ¨
    await this.validateSkillIds(dto.skillIds);

    // åˆ›å»ºæ¨¡æ¿
    return this.prisma.badgeTemplate.create({
      data: {
        ...dto,
        imageUrl,
        createdBy: userId,
      },
      include: {
        creator: {
          select: { id: true, username: true, email: true }
        }
      }
    });
  }

  private async validateSkillIds(skillIds: string[]): Promise<void> {
    const skills = await this.prisma.skill.findMany({
      where: { id: { in: skillIds } }
    });

    if (skills.length !== skillIds.length) {
      throw new BadRequestException('One or more skill IDs are invalid');
    }
  }
}
```

**æµ‹è¯•è¦æ±‚ï¼š**
- [ ] å›¾ç‰‡ä¸Šä¼ æˆåŠŸæµ‹è¯•
- [ ] å›¾ç‰‡æ ¼å¼éªŒè¯æµ‹è¯•
- [ ] å›¾ç‰‡å¤§å°éªŒè¯æµ‹è¯•
- [ ] æ— å›¾ç‰‡åˆ›å»ºæ¨¡æ¿æµ‹è¯•
- [ ] æŠ€èƒ½IDéªŒè¯æµ‹è¯•
- [ ] æƒé™æ§åˆ¶æµ‹è¯•ï¼ˆä»…ç®¡ç†å‘˜å¯åˆ›å»ºï¼‰

---

## Story 3.3: æŸ¥è¯¢å¾½ç« æ¨¡æ¿API

**ä¼˜å…ˆçº§ï¼š** P0  
**ä¼°ç®—æ—¶é—´ï¼š** 3-4å°æ—¶  
**ä¾èµ–ï¼š** Story 3.2  
**é£é™©ç­‰çº§ï¼š** Low

### ç”¨æˆ·æ•…äº‹
> ä½œä¸º**æ™®é€šç”¨æˆ·/ç®¡ç†å‘˜**ï¼Œæˆ‘éœ€è¦**æŸ¥çœ‹å¾½ç« æ¨¡æ¿åˆ—è¡¨å’Œè¯¦æƒ…**ï¼Œä»¥ä¾¿**äº†è§£å¯ä»¥è·å¾—å“ªäº›å¾½ç« **ã€‚

### éªŒæ”¶æ ‡å‡†
- [ ] GET /api/badge-templatesï¼ˆå…¬å¼€ï¼Œä»…è¿”å›ACTIVEçŠ¶æ€ï¼‰
- [ ] GET /api/admin/badge-templates/:idï¼ˆç®¡ç†å‘˜ï¼Œæ‰€æœ‰çŠ¶æ€ï¼‰
- [ ] æ”¯æŒåˆ†é¡µã€æ’åºã€ç­›é€‰
- [ ] è¿”å›å…³è”çš„æŠ€èƒ½ä¿¡æ¯
- [ ] å“åº”æ—¶é—´ < 200ms

### æŠ€æœ¯ä»»åŠ¡

**Task 3.3.1: åˆ›å»ºæŸ¥è¯¢DTO**ï¼ˆ0.5å°æ—¶ï¼‰
```typescript
export class QueryBadgeTemplatesDto {
  @IsOptional()
  @IsInt()
  @Min(1)
  @Type(() => Number)
  page?: number = 1;

  @IsOptional()
  @IsInt()
  @Min(1)
  @Max(100)
  @Type(() => Number)
  limit?: number = 10;

  @IsOptional()
  @IsString()
  category?: string;

  @IsOptional()
  @IsUUID('4')
  skillId?: string;

  @IsOptional()
  @IsString()
  search?: string;
}
```

**Task 3.3.2: å®ç°å…¬å¼€æŸ¥è¯¢æ¥å£**ï¼ˆ1.5å°æ—¶ï¼‰

âš ï¸ **å®é™…å®ç°ï¼š** æŸ¥è¯¢APIåœ¨åŒä¸€ä¸ªControllerä¸­é€šè¿‡ä¸åŒendpointåŒºåˆ†ï¼ˆå…¬å¼€ vs ç®¡ç†ï¼‰

```typescript
// gcredit-project/backend/src/badge-templates/badge-templates.controller.ts
@Controller('badge-templates')
export class BadgeTemplatesController {
  @Get()
  async findAll(@Query() query: QueryBadgeTemplatesDto) {
    return this.badgeTemplatesService.findAll(query, true); // onlyActive=true
  }
}

// Serviceå®ç°
async findAll(query: QueryBadgeTemplatesDto, onlyActive = false) {
  const { page, limit, category, skillId, search } = query;
  const skip = (page - 1) * limit;

  const where: Prisma.BadgeTemplateWhereInput = {
    ...(onlyActive && { status: BadgeStatus.ACTIVE }),
    ...(category && { category }),
    ...(skillId && { skillIds: { has: skillId } }),
    ...(search && {
      OR: [
        { name: { contains: search, mode: 'insensitive' } },
        { description: { contains: search, mode: 'insensitive' } }
      ]
    })
  };

  const [data, total] = await Promise.all([
    this.prisma.badgeTemplate.findMany({
      where,
      skip,
      take: limit,
      orderBy: { createdAt: 'desc' },
      include: {
        creator: {
          select: { id: true, username: true }
        }
      }
    }),
    this.prisma.badgeTemplate.count({ where })
  ]);

  return {
    data,
    meta: {
      page,
      limit,
      total,
      totalPages: Math.ceil(total / limit)
    }
  };
}
```

**Task 3.3.3: å®ç°ç®¡ç†å‘˜è¯¦æƒ…æŸ¥è¯¢**ï¼ˆ1å°æ—¶ï¼‰
```typescript
@Controller('admin/badge-templates')
@UseGuards(JwtAuthGuard, RolesGuard)
@Roles(UserRole.ADMIN)
export class BadgeTemplatesController {
  @Get(':id')
  async findOne(@Param('id') id: string) {
    const template = await this.badgeTemplatesService.findOne(id);
    
    if (!template) {
      throw new NotFoundException('Badge template not found');
    }
    
    return template;
  }
}

// Serviceå®ç°ï¼ˆå«æŠ€èƒ½ä¿¡æ¯ï¼‰
async findOne(id: string) {
  const template = await this.prisma.badgeTemplate.findUnique({
    where: { id },
    include: {
      creator: {
        select: { id: true, username: true, email: true }
      }
    }
  });

  if (!template) return null;

  // è·å–å…³è”çš„æŠ€èƒ½ä¿¡æ¯
  const skills = await this.prisma.skill.findMany({
    where: { id: { in: template.skillIds } },
    include: {
      category: {
        select: { id: true, name: true, nameEn: true }
      }
    }
  });

  return {
    ...template,
    skills
  };
}
```

**æµ‹è¯•è¦æ±‚ï¼š**
- [ ] å…¬å¼€æ¥å£ä»…è¿”å›ACTIVEçŠ¶æ€
- [ ] åˆ†é¡µåŠŸèƒ½æ­£ç¡®
- [ ] åˆ†ç±»ç­›é€‰æ­£ç¡®
- [ ] æŠ€èƒ½IDç­›é€‰æ­£ç¡®
- [ ] æœç´¢åŠŸèƒ½æ­£ç¡®ï¼ˆåç§°+æè¿°ï¼‰
- [ ] ç®¡ç†å‘˜å¯æŸ¥çœ‹æ‰€æœ‰çŠ¶æ€
- [ ] ä¸å­˜åœ¨çš„IDè¿”å›404

---

## Story 3.4: å¾½ç« ç›®å½•ä¸æœç´¢ä¼˜åŒ–

**ä¼˜å…ˆçº§ï¼š** P1  
**ä¼°ç®—æ—¶é—´ï¼š** 4-5å°æ—¶  
**ä¾èµ–ï¼š** Story 3.3  
**é£é™©ç­‰çº§ï¼š** Low

### ç”¨æˆ·æ•…äº‹
> ä½œä¸º**æ™®é€šç”¨æˆ·**ï¼Œæˆ‘éœ€è¦**ä¾¿æ·åœ°æµè§ˆå’Œæœç´¢å¾½ç« æ¨¡æ¿**ï¼Œä»¥ä¾¿**å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„å¾½ç« **ã€‚

### éªŒæ”¶æ ‡å‡†
- [ ] æ”¯æŒå¤šæ¡ä»¶ç»„åˆç­›é€‰
- [ ] æ”¯æŒæŒ‰æŠ€èƒ½åˆ†ç±»æ ‘çŠ¶æµè§ˆ
- [ ] æœç´¢æ€§èƒ½ä¼˜åŒ–ï¼ˆæ•°æ®åº“ç´¢å¼•ï¼‰
- [ ] è¿”å›ç­›é€‰ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¦‚ï¼šæ¯ä¸ªåˆ†ç±»ä¸‹çš„å¾½ç« æ•°é‡ï¼‰
- [ ] å“åº”æ—¶é—´ < 150ms

### æŠ€æœ¯ä»»åŠ¡

**Task 3.4.1: ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•**ï¼ˆ1å°æ—¶ï¼‰
```prisma
model BadgeTemplate {
  // ... existing fields
  
  @@index([category, status])
  @@index([createdAt])
}
```

**Task 3.4.2: å®ç°åˆ†ç±»æ ‘çŠ¶æµè§ˆ**ï¼ˆ2å°æ—¶ï¼‰

**Task 3.4.3: å®ç°é«˜çº§æœç´¢**ï¼ˆ1-1.5å°æ—¶ï¼‰

**Task 3.4.4: æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–**ï¼ˆ0.5å°æ—¶ï¼‰

**æµ‹è¯•è¦æ±‚ï¼š**
- [ ] åˆ†ç±»æ ‘æ­£ç¡®è¿”å›3å±‚ç»“æ„
- [ ] å¾½ç« æ•°é‡ç»Ÿè®¡å‡†ç¡®
- [ ] å¤šæ¡ä»¶ç­›é€‰æ­£ç¡®
- [ ] æ’åºåŠŸèƒ½æ­£ç¡®
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡ï¼ˆ<150msï¼‰

---

## Story 3.5: é¢å‘æ ‡å‡†å®šä¹‰

**ä¼˜å…ˆçº§ï¼š** P1  
**ä¼°ç®—æ—¶é—´ï¼š** 3-4å°æ—¶  
**ä¾èµ–ï¼š** Story 3.2  
**é£é™©ç­‰çº§ï¼š** Mediumï¼ˆJSON SchemaéªŒè¯å¤æ‚ï¼‰

### ç”¨æˆ·æ•…äº‹
> ä½œä¸º**ç®¡ç†å‘˜**ï¼Œæˆ‘éœ€è¦**å®šä¹‰å¾½ç« çš„é¢å‘æ ‡å‡†**ï¼Œä»¥ä¾¿**ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç¬¦åˆè·å¾—å¾½ç« çš„æ¡ä»¶**ã€‚

### éªŒæ”¶æ ‡å‡†
- [ ] æ”¯æŒå¤šç§é¢å‘æ ‡å‡†ç±»å‹ï¼ˆå®Œæˆä»»åŠ¡ã€å­¦ä¹ æ—¶é•¿ã€è€ƒè¯•åˆ†æ•°ç­‰ï¼‰
- [ ] JSON SchemaéªŒè¯æ ‡å‡†æ ¼å¼
- [ ] æä¾›æ ‡å‡†æ¨¡æ¿ï¼ˆå¸¸è§åœºæ™¯ï¼‰
- [ ] æ›´æ–°/åˆ é™¤é¢å‘æ ‡å‡†

### æŠ€æœ¯ä»»åŠ¡

**Task 3.5.1: å®šä¹‰é¢å‘æ ‡å‡†Schema**ï¼ˆ1.5å°æ—¶ï¼‰

**Task 3.5.2: åˆ›å»ºéªŒè¯Service**ï¼ˆ1å°æ—¶ï¼‰

**Task 3.5.3: æ›´æ–°BadgeTemplate Service**ï¼ˆ0.5å°æ—¶ï¼‰

**Task 3.5.4: åˆ›å»ºæ ‡å‡†æ¨¡æ¿API**ï¼ˆ1å°æ—¶ï¼‰

**æµ‹è¯•è¦æ±‚ï¼š**
- [ ] SchemaéªŒè¯æµ‹è¯•ï¼ˆå„ç§é¢å‘æ ‡å‡†ç±»å‹ï¼‰
- [ ] æ— æ•ˆæ ¼å¼è¿”å›æ¸…æ™°é”™è¯¯ä¿¡æ¯
- [ ] æ¨¡æ¿APIæ­£ç¡®è¿”å›
- [ ] éªŒè¯æ¥å£æ­£ç¡®å·¥ä½œ

---

## Story 3.6: è‡ªå®šä¹‰æŠ€èƒ½åˆ†ç±»ç®¡ç†

**ä¼˜å…ˆçº§ï¼š** P1  
**ä¼°ç®—æ—¶é—´ï¼š** 4-5å°æ—¶  
**ä¾èµ–ï¼š** Story 3.1  
**é£é™©ç­‰çº§ï¼š** Medium

### ç”¨æˆ·æ•…äº‹
> ä½œä¸º**ç®¡ç†å‘˜**ï¼Œæˆ‘éœ€è¦**åœ¨é¢„è®¾åˆ†ç±»ä¸‹æ·»åŠ è‡ªå®šä¹‰å­åˆ†ç±»**ï¼Œä»¥ä¾¿**é€‚åº”å…¬å¸ç‰¹å®šçš„æŠ€èƒ½ä½“ç³»**ã€‚

### éªŒæ”¶æ ‡å‡†
- [ ] å¯åœ¨ä»»ä½•é¢„è®¾åˆ†ç±»ä¸‹æ·»åŠ è‡ªå®šä¹‰å­åˆ†ç±»
- [ ] æ”¯æŒæœ€å¤š3å±‚åµŒå¥—
- [ ] ä¸å¯ç¼–è¾‘ç³»ç»Ÿé¢„è®¾çš„é¡¶å±‚5ä¸ªåˆ†ç±»
- [ ] å¯ç¼–è¾‘/åˆ é™¤è‡ªå®šä¹‰åˆ†ç±»
- [ ] åˆ é™¤åˆ†ç±»æ—¶çº§è”å¤„ç†å…³è”æŠ€èƒ½

### æŠ€æœ¯ä»»åŠ¡

**Task 3.6.1: åˆ›å»ºåˆ†ç±»ç®¡ç†DTO**ï¼ˆ0.5å°æ—¶ï¼‰

**Task 3.6.2: å®ç°åˆ›å»º/æ›´æ–°/åˆ é™¤API**ï¼ˆ2.5å°æ—¶ï¼‰

**Task 3.6.3: åˆ›å»ºæŠ€èƒ½ç®¡ç†API**ï¼ˆ1.5å°æ—¶ï¼‰

**æµ‹è¯•è¦æ±‚ï¼š**
- [ ] åˆ›å»ºè‡ªå®šä¹‰å­åˆ†ç±»æˆåŠŸ
- [ ] ä¸å¯åˆ›å»ºé¡¶å±‚è‡ªå®šä¹‰åˆ†ç±»
- [ ] ä¸å¯è¶…è¿‡3å±‚åµŒå¥—
- [ ] ä¸å¯ç¼–è¾‘ç³»ç»Ÿé¢„è®¾é¡¶å±‚åˆ†ç±»
- [ ] åˆ é™¤æœ‰å­åˆ†ç±»çš„åˆ†ç±»å¤±è´¥
- [ ] åˆ é™¤æœ‰æŠ€èƒ½çš„åˆ†ç±»å¤±è´¥
- [ ] æŠ€èƒ½åç§°åœ¨åŒä¸€åˆ†ç±»ä¸‹å”¯ä¸€

---

## Enhancement: Azure Blobå›¾ç‰‡å®Œæ•´ç®¡ç†

**ä¼°ç®—æ—¶é—´ï¼š** 2-3å°æ—¶

### ä»»åŠ¡

**Task E1.1: å®ç°å›¾ç‰‡åˆ é™¤åŠŸèƒ½**ï¼ˆ1å°æ—¶ï¼‰

**Task E1.2: å›¾ç‰‡å°ºå¯¸éªŒè¯ä¸ä¼˜åŒ–å»ºè®®**ï¼ˆ1å°æ—¶ï¼‰

**Task E1.3: å›¾ç‰‡é¢„è§ˆä¸CDNé…ç½®**ï¼ˆ0.5-1å°æ—¶ï¼‰

---

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•ï¼ˆæ¯ä¸ªStoryå®Œæˆåï¼‰
- Serviceå±‚æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- ä½¿ç”¨Jest + Prisma Mock
- é‡ç‚¹æµ‹è¯•ä¸šåŠ¡é€»è¾‘å’ŒéªŒè¯è§„åˆ™

### é›†æˆæµ‹è¯•
- APIç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆä½¿ç”¨Supertestï¼‰
- æ•°æ®åº“é›†æˆæµ‹è¯•ï¼ˆæµ‹è¯•æ•°æ®åº“ï¼‰
- Azure Blobé›†æˆæµ‹è¯•ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

### æµ‹è¯•æ•°æ®
```typescript
// tests/fixtures/badge-templates.fixture.ts
export const testBadgeTemplates = [
  {
    name: 'TypeScripté«˜çº§è®¤è¯',
    category: 'skill',
    skillIds: ['<æŠ€æœ¯æŠ€èƒ½-ç¼–ç¨‹è¯­è¨€-TypeScript>'],
    issuanceCriteria: {
      type: 'exam_score',
      conditions: [
        { field: 'examId', operator: '==', value: 'ts-advanced' },
        { field: 'score', operator: '>=', value: 90 }
      ]
    }
  },
  {
    name: 'å›¢é˜Ÿåä½œå¤§å¸ˆ',
    category: 'achievement',
    skillIds: ['<è½¯æŠ€èƒ½-å›¢é˜Ÿåä½œ>'],
    issuanceCriteria: {
      type: 'composite',
      conditions: [
        { field: 'projectsCompleted', operator: '>=', value: 5 },
        { field: 'peerEndorsements', operator: '>=', value: 10 }
      ],
      logic: 'AND'
    }
  }
];
```

---

## é£é™©ç®¡ç†

| é£é™© | ç­‰çº§ | ç¼“è§£æªæ–½ |
|-----|------|---------|
| Azure Blobé›†æˆå¤±è´¥ | Medium | æå‰æµ‹è¯•è¿æ¥ï¼Œå‡†å¤‡é™çº§æ–¹æ¡ˆï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰ |
| æŠ€èƒ½åˆ†ç±»è®¾è®¡è¿‡äºå¤æ‚ | Medium | å…ˆå®ç°åŸºç¡€3å±‚ï¼Œå¤æ‚é€»è¾‘å»¶å |
| å›¾ç‰‡ä¸Šä¼ æ€§èƒ½é—®é¢˜ | Low | æ·»åŠ æ–‡ä»¶å¤§å°é™åˆ¶ï¼Œä½¿ç”¨æµå¼ä¸Šä¼  |
| é¢å‘æ ‡å‡†éªŒè¯å¤æ‚ | Medium | ä½¿ç”¨æˆç†Ÿçš„JSON Schemaåº“ï¼ˆAjvï¼‰ |
| å·¥ä½œé‡è¶…å‡ºé¢„æœŸ | Medium | ä¼˜å…ˆå®ŒæˆP0ä»»åŠ¡ï¼ŒP1ä»»åŠ¡å¯è°ƒæ•´ |

---

## Definition of Done

æ¯ä¸ªStoryéœ€æ»¡è¶³ï¼š
- [ ] ä»£ç å®Œæˆä¸”é€šè¿‡Code Review
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] APIæ–‡æ¡£æ›´æ–°ï¼ˆSwaggerï¼‰
- [ ] æ•°æ®åº“è¿ç§»è„šæœ¬æµ‹è¯•é€šè¿‡
- [ ] æ— é˜»å¡æ€§bug
- [ ] äº§å“éªŒæ”¶é€šè¿‡

---

## Sprint 2æ—¶é—´è¡¨

### Week 1ï¼ˆ2026-01-27 è‡³ 01-31ï¼Œ5ä¸ªå·¥ä½œæ—¥ï¼‰

**Day 1-2ï¼ˆ1æœˆ27-28æ—¥ï¼‰ï¼š** Story 3.1 + Story 3.6
- æ•°æ®æ¨¡å‹è®¾è®¡ä¸è¿ç§»
- ç§å­æ•°æ®åˆ›å»º
- è‡ªå®šä¹‰åˆ†ç±»ç®¡ç†API

**Day 3-4ï¼ˆ1æœˆ29-30æ—¥ï¼‰ï¼š** Story 3.2
- Azure Blobé…ç½®
- å›¾ç‰‡ä¸Šä¼ Service
- åˆ›å»ºå¾½ç« æ¨¡æ¿API

**Day 5ï¼ˆ1æœˆ31æ—¥ï¼‰ï¼š** Story 3.3
- æŸ¥è¯¢å¾½ç« æ¨¡æ¿API
- å¼€å§‹é›†æˆæµ‹è¯•

### Week 2ï¼ˆ2026-02-03 è‡³ 02-07ï¼Œ5ä¸ªå·¥ä½œæ—¥ï¼‰

**Day 6-7ï¼ˆ2æœˆ3-4æ—¥ï¼‰ï¼š** Story 3.4 + Story 3.5
- æœç´¢ä¼˜åŒ–
- é¢å‘æ ‡å‡†å®šä¹‰

**Day 8ï¼ˆ2æœˆ5æ—¥ï¼‰ï¼š** Enhancement E1
- å›¾ç‰‡å®Œæ•´ç®¡ç†åŠŸèƒ½

**Day 9ï¼ˆ2æœˆ6æ—¥ï¼‰ï¼š** æµ‹è¯•ä¸bugä¿®å¤
- å®Œæˆæ‰€æœ‰æµ‹è¯•
- ä¿®å¤å‘ç°çš„é—®é¢˜
- æ€§èƒ½ä¼˜åŒ–

**Day 10ï¼ˆ2æœˆ7æ—¥ï¼‰ï¼š** Sprint 2æ”¶å°¾
- æ–‡æ¡£æ›´æ–°
- Demoå‡†å¤‡
- Sprint 2 Retrospective

---

## äº¤ä»˜ç‰©æ¸…å•

### ä»£ç 
- [ ] 3ä¸ªæ–°çš„Prismaæ¨¡å‹ï¼ˆBadgeTemplate, Skill, SkillCategoryï¼‰
- [ ] 15+ä¸ªæ–°APIç«¯ç‚¹
- [ ] Azure Blob Storageé›†æˆ
- [ ] 60+ä¸ªæµ‹è¯•ç”¨ä¾‹

### æ–‡æ¡£
- [ ] APIæ–‡æ¡£ï¼ˆSwaggerï¼‰
- [ ] æ•°æ®æ¨¡å‹æ–‡æ¡£
- [ ] é¢å‘æ ‡å‡†Schemaæ–‡æ¡£
- [ ] Azure Blobé…ç½®æŒ‡å—
- [ ] Sprint 2 Retrospective

### æ•°æ®
- [ ] 5ä¸ªé¢„è®¾æŠ€èƒ½åˆ†ç±»æ¨¡æ¿
- [ ] 20+ä¸ªç¤ºä¾‹å­åˆ†ç±»
- [ ] 50+ä¸ªç¤ºä¾‹æŠ€èƒ½
- [ ] 10ä¸ªæµ‹è¯•å¾½ç« æ¨¡æ¿

---

**BacklogçŠ¶æ€ï¼š** âœ… Approved by Product Owner  
**å‡†å¤‡å¼€å§‹ï¼š** 2026-01-27  
**ä¼°ç®—å®Œæˆï¼š** 2026-02-07
